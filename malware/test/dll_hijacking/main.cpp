#include <windows.h>
#include <stdio.h>
#include <process.h>

BOOL WINAPI
DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
    switch(dwReason){
        case DLL_PROCESS_ATTACH:

            // int pid = _getpid();
          
            system("whoami >> C:\\users\\john\\whoami.txt");
            // echo pid > C:\\users\\john\\pid.txt
              char pid_str[10];
            sprintf(pid_str, "%d", pid);
            char *cmd = "echo ";
            char *cmd2 = " >> C:\\users\\john\\pid.txt";
            char *cmd3 = strcat(cmd, pid_str);
            char *cmd4 = strcat(cmd3, cmd2);
            system(cmd4);
            WinExec("calc.exe", 0); //This doesn't accept redirections like system
            break;
        case DLL_PROCESS_DETACH:
            break;
        case DLL_THREAD_ATTACH:
            break;
        case DLL_THREAD_DETACH:
            break;
    }
    return TRUE;
}